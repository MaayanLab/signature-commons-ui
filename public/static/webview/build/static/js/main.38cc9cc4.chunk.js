(this.webpackJsonpwebview=this.webpackJsonpwebview||[]).push([[0],{216:function(e,t,a){},218:function(e,t,a){},237:function(e,t,a){},245:function(e,t,a){"use strict";a.r(t);var n=a(7),i=a(1),s=a.n(i),r=a(17),o=a.n(r),l=(a(216),a(44)),c=a(13),h=a.n(c),u=a(9),d=a(30),p=a(27),f=(a(218),a(26)),y=a(11),v=a(3),b=a(4),m=a(0),A=a(5),g=a(2),j=a(94),O=a(95),C=a(10),w={circle:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACtElEQVRYR+2Wz2sTQRTH5+2mNu2QbJY1Ymuym9nkInjwR/HgQRQVEf8Db9KDB0+K+CfovT0IIuKf4EVBUfSioGD1KJjdndmEEJrY1mQDadjdkZFWSkmT3aQShO5133vfz7z9znsLaMIPTFgfHQD8nx2wLOs6ABQ45/qWhxhCiBWLxRdxPRW5A/V6HXe73UdhGN7AGNclSTqWSCT+6Pm+j8IwrHqedxQAnhFCbgNALwpMJADbts8DwHNVVdV0Oo0A+qdxzlGr1ULr6+utIAiulUqlj8MghgLUarUF3/ff5vP59LBiO99Xq9W2LMsX5ufnVwblDQQol8snpqamPui6Hkt8W5Ax1uacnyWEfN8LYiAApbSZy+U0WZbjHP5vbBAEyHXdhmmaR2IDUErvzs7OPshms9MjqW8lNRqNzU6nc58QstSvzp4dYIx91TTtJMZ4HH3U6XTQ2traF13XF2IBWJYVEkJgL8dHpRI3g1IamqbZ9zv27YBt21eSyeTrubm5qDoD42q1Gur1ehcJIe93B/YFoJQ+yWQyi4qi7AvAxsaGmA+PDcO4FRlAUZTFTCYzGQDLsi7NzMy8mdgnEMfeLxOGYYgYY/FMKAAYYyuapp2a2DV0HOcOxvjhuINodXW11+127xmGsRxrDohgx3Ga+Xx+5FEs1nSlUmmappmNPYpFAqX0OELok2EYqVGug+u6nu/7p4vF4o+RALa8cAYh9E7X9VgQruv+Eus4l8t9G3kdbyeWy+Vzsiy/VFVVSaVSSJKkvjWF49vttpj9bYTQZdM0Pw/r3NAfku0CnPNDtm0vAcBNjHETAIQ3psWu8H1/k3P+0/O8w5IkPS0UCuKXLBwmLt5HBthZzHGcq0EQFADA4JwLIVeWZUYIeRVFdGfMSABxRcb2wH4KRlpG/1LwAGB3B34DBWQWMG24djEAAAAASUVORK5CYII=",cross:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA50lEQVRYR+2XPQ6DMAyF8QZbfIYchN4spRer6D1yBcyWbKmylZI4WB0oklmdn8cnvfcAupMfOPn+7noCvPeOo2atnSRURQTy5cMwuL7vi/tijCmE8LDW3o+KEAtARIeIxX1ElIhIBSiBixNo+HxExBvngmVZXgDwrNnwOyc2dmr5PB+KiKzFiag6L+XETgDn86PhUltXygkVoAT+jwBXt7/aMITQxRinz7re1ar3vtrlADAaY3IYVet4Xdc5pTQzQbQ5X78HlIASEBPgcqLk81aDigTkw7icyHPJP0FeLxbQeiPpXAW8AUg5MTAvQNb8AAAAAElFTkSuQmCC",diamond:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACaElEQVRYR9WXy4vTUBTG05DW2E7sI6XPlOTeUkTcqeB2QHApIrgTXIr+AbrVlW5cKbidlStFXKsrl+IsB4T23tiGtolp2pLbTh9JkQwpjNppmkyHYFaB3POdX777OidCBXwQQhdpmv5GUdRisVhchxD+CCIVCRLkxGCMv+fz+SvOu6qq+wCAq0G0AgHU6/Xb8Xh8r1gsJp2knU5nOJ1O7wMAPvqFCASAMTYEQUgzDHOUz7IsqtVq9SGEmTMHwBg/5TjuCc/z7PFkvV5vYprmCwDAMz8QvhzQNG2HEKIDAM6tSoIxnrEsmy6VSuNNIXwBYIzf8zx/h+O4lfqmaVKGYbyTJOnu1gEajca1aDT6pVKpXFgnriiKadv2riRJ+5tAbOwAxvigUChcYtk/pv6fHJPJhOp2uwcAgMtbA0AI3UskEm9yudzOJqKqqpLRaPSgWq2+9Rq/kQMIoUNRFFmapr30jr7btk01m80xhDDhFeAJgBB6mUqlHqbT6fNeYse/9/v9w8Fg8BpC+Hhd3FoAjHEhEok0RFGM+0m+HCvL8tiyLKlWq/06KX4tgCzLn7PZ7I1EwtPJlfqEEErX9U8AgJu+ATDGuwzDfBAEIRXk75cxiqIM5vP5LQjh11U6JzqAEGqWy+VKLBY7TX5qNptR7Xb7JwBA+r8AQp8Cx65QF6EDEPo2dCCcgyiZTD7KZDLrL4G/VphhGJPhcPjqVAfRUjPUo9h1wddlpGkaIYRs7zJy10N417EDEHpB4roQXknmAIRelLourCzLdV2fEkKen2lZvtyWoTYmDkTorZk7FeE1p+7htJX2/DfV7WYwLPkGlAAAAABJRU5ErkJggg==",square:",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAp0lEQVRYR+2WMQ4CIRBFWQoyFQ03YG7naqPHsNEY9XLADSjooFrD1mJixmRj8qlh/ssbij+pjc+0cb4CAAx8NBBCOGitjfCjVu/9fTRjCNDDiehKRKI1tdaWWuuemR/vIIbDU0ona+3ZOScCyDkvpZQjM18AAAMwAAMwAAMw8HcGZmPM7UeFZGbm51cG+uUY404pJa1kbRTeM0RtR9gV1+cAgIHNDbwAdNviIRMkcw0AAAAASUVORK5CYII=","triangle-down":",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC2klEQVRYR+2WPWzTQBiGnR/iFrs4pFadpolyn09VJZAYOjDQCYmFiYVKIDHQgRWxMCAhIaSuHWCEAXWknZAQG1IHJAbEAggGcpc4bVK3Sdu0SUwSXBu5clHTpk7sJC0D3uLcfe9z730/9jGn/PhOWZ/5dwAURblgGEbiJBzx+XxZhNAPS+uvA5RSJRQK8f0GME3Tp+v6NgBAEwAh5DbHcS8lSeL6CbG2tlbVNG1GluXFJgDrRyaT+SZJ0sWBgYG+MNRqNUZV1a8AcGlfoCkJM5nMZCAQWIrH40P9IFheXq7ouj4ly/KXlgC2C4uRSOTm0FBvGXZ2dpjNzc3XAHDr4OGOlGE+nz9bq9W2ACDUSxcopbphGPz4+HjdEcD6M51OP+F5/pEoimwvIIrFYr1cLs/Ksjx7ON6xjSidTm/E4/FIMBjsikHXdWZlZWUDAMRWgZwAbrAsOz86Oip0Q6Cq6ramaXcwxm9dAdhX8VmSpMnBwUFPDJqmMcVi8VMymbx8XADHWUApnfD7/VYATyWRzWatspvEGP/0BGBtUhRlXhCEaUEQXNlQKpV+lUqlBQC462RfR9OQEGLKsuzqGiilDMa4bfy2C+zm9JDjuMeiKJ7rhKJQKJQ1TXuKEJprt74jADshV2OxWDQUcu5PjUaDyefzqwAQayd+ZBg5bSCEXGNZdmFsbOy807pcLrdVr9enMcbvewpgJ+SH4eHhKY5rPbGr1SpTKBSWAOBqJ+KuHLAWp1KpRDAY/J5MJlt+uCiKUg0EAhOJRCLXFwA7F56Fw+F74XC4qSztsnsBAA86FXftwH5gQkgDIXTG7/fvvTIMw/qY+Y0xdj1BO66Cg6cihMzwPP98ZGRk7yrW19crlUrlPsb4lZvTe3bA7g0kGo3udSdVVSlCCLsV7woglUpdYVn2nRVkd3f3OkLo44kC2GX5xjRNKx+mvYh35YBXwcP7PCVhr8T/O2A58AfGZw8wtSahoQAAAABJRU5ErkJggg==","triangle-up":",iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC3UlEQVRYR+2VP2gTURzHLyG5tOnFXD0uJsTj3u9dB4s4iIIOIk5uDnUQQdChuApOBScFh4KDg4uDOgkKKoKO4iAI4lIciiD03rtoSnOJTbzcJTmS651EraTm312a2qVvvd/v+/2873vvdyFml1dol/2ZPYBtJUApfdk+QgCYG/UoRwZQVfVULBZ77Xke02w2zymK8n4UiJEBKKU0k8mgtmmhUKAIIfzfAAgh8xzH3RVFMdE2LRaLZq1Wu44xfhgUYqQEVFVtAUAkFPrd7rouo2maoyhKdMcBCCH3eJ6fn56enuw0q1QqjWq1+gAhdC0IRKAECCFyOBxelmWZ62WSy+WsjY2Nw4qifPULEQhA07QPoiiejMfjPfVrtRpTKpXeAcCZsQMQQs6yLPskm83uHyS+urpabjabFzHGb/xA+E6AUlrIZrMHotHB96zVajH5fF7HGKfHBkApXZiamrohiuI+P6KlUqlar9dvI4TuDKsfmoDneWFCSAtjHB4m1vmdEOIpijK0ZyiApmmPeZ6fSyaTvW9eHyrDMOqGYTyXZfnKIPCBAJqmzTIM81GW5V8TL+jK5XKG67onMMZf+vUOA1hKpVJHJye3zBzfHI1Gg9F1fQkAjgUGWFlZmYvH448ymQzv27FH4drammHb9mWM8ateOn0TIIRUJEniI5HIdvwZx3Haz7IMAIJvAErpzUQisSAIwsS23P80r6+v26ZpLgLArX/1uhIoFoucZVnfASA2DvNNjfZTZlk2KUlSo1O3C4BS+kIQhPOJxEgXvy+zaZpMuVx+hhC60BdAVdXj0Wj0rSRJviZe0ITy+bzpOM5pAPi02bslAUrp53Q6PTsxMZaj7+Kzbbv9LJcRQke6AFRVvcRx3P1UKtXzXx90t/3qdV23LMu6OjMz87Rd8zcBQojGsuyORN8J43leyHGcHwAAWwAopYdc1z04rp0OnP+h0LfN8Tz0Z7TTQHsAPwHv3BIw9zTkUQAAAABJRU5ErkJggg=="},S=function(){function e(t){Object(m.a)(this,e),this.symbolType=t}return Object(A.a)(e,[{key:"load",value:function(){var e=new Image;e.src="data:image/png;base64"+w[this.symbolType];var t=new g.p(e);return t.needsUpdate=!0,t}}]),e}(),k=Object.keys(w),x=a(14);var I="other";function K(e){var t=typeof e;return"number"===t&&(t="int",Number.isInteger(e)||(t="float")),t}function U(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=e[t[n]];return a}function M(e,t){var a=C.a.countBy(e);a=C.a.sortBy(C.a.pairs(a),(function(e){return-e[1]}));for(var n=C.a.map(a.slice(0,t),(function(e){return e[0]})),i=0;i<e.length;i++)-1===n.indexOf(e[i])&&(e[i]=I);return e}function B(e,t){for(var a=x.a(e),n=parseFloat(a[0]),i=parseFloat(a[1]),s=(i-n)/t,r=C.a.range(1,t).map((function(e){return e*s+n})),o=[n.toFixed(2)+" to "+r[0].toFixed(2)],l=0;l<t-1;l++){var c=void 0;c=l===t-2?r[l].toFixed(2)+" to "+i.toFixed(2):r[l].toFixed(2)+" to "+r[l+1].toFixed(2),o.push(c)}return{labels:o,domain:r,min:n,max:i,interval:s}}function D(e,t){for(var a=x.a(e),n=parseFloat(a[0]),i=parseFloat(a[1]),s=["0 to "+t[0]],r=t.length,o=0;o<r-1;o++){var l=t[o]+" to "+t[o+1];s.push(l)}return{labels:s,domain:t.slice(0,-1),min:n,max:i}}var E=a(252),R=a(250),T=a(251),P=function(){function e(t){Object(m.a)(this,e),this.data=t,this.n=t.length;var a=this.getIndicesAndPositions(t),n=a.indices,i=a.positions;this.indices=n,this.positions=i}return Object(A.a)(e,[{key:"getIndicesAndPositions",value:function(e){for(var t=this.n,a=new Uint32Array(t),n=new Float32Array(3*t),i=0;i<t;i++)a[i]=i,n[3*i]=e[i].x,n[3*i+1]=e[i].y,n[3*i+2]=e[i].z||0;return{indices:a,positions:n}}},{key:"getAttr",value:function(e){return this.data.map((function(t){return t[e]}))}}]),e}(),z=function(){function e(t){Object(m.a)(this,e),this.data=t,this.n=t.length,this.metas=[],this.parse();var a=this.getIndicesAndPositions(),n=a.indices,i=a.positions;this.indices=n,this.positions=i}return Object(A.a)(e,[{key:"parse",value:function(){for(var e=this,t=this.data,a=["x","y","z"],n=function(){var n=s[i];if(-1===a.indexOf(n)){var r=t.map((function(e){return e[n]})),o=Object(f.a)(new Set(r)).length,l=K(t[0][n]);e.metas.push({name:n,nUnique:o,type:l})}},i=0,s=Object.keys(t[0]);i<s.length;i++)n()}},{key:"getIndicesAndPositions",value:function(){for(var e=this.n,t=new Uint32Array(e),a=new Float32Array(3*e),n=0;n<e;n++)t[n]=n,a[3*n]=this.data[n].x,a[3*n+1]=this.data[n].y,a[3*n+2]=this.data[n].z||0,this.data[n].index=n;return{indices:t,positions:a}}},{key:"getLabels",value:function(e){var t,a=this.n,n=new Array(a),i=0,s=Object(u.a)(this.data);try{for(s.s();!(t=s.n()).done;){var r,o=t.value,l="",c=Object(u.a)(e);try{for(c.s();!(r=c.n()).done;){var h=r.value;l+=h+": "+o[h]+" \n"}}catch(d){c.e(d)}finally{c.f()}n[i]=l,i++}}catch(d){s.e(d)}finally{s.f()}return n}},{key:"groupBy",value:function(e){var t=C.a.groupBy(this.data,e);return C.a.mapObject(t,(function(e,t){return new P(e)}))}},{key:"binBy",value:function(e,t){var a=function(e,t,a){var n=B(C.a.pluck(e,t),a),i=n.labels,s=n.min,r=n.interval;return C.a.groupBy(e,(function(e){var n=Math.floor((e[t]-s)/r);return n===a&&(n=a-1),i[n]}))}(this.data,e,t);return C.a.mapObject(a,(function(e,t){return new P(e)}))}},{key:"binBy2",value:function(e,t){var a=function(e,t,a){var n=D(C.a.pluck(e,t),a).labels;return C.a.groupBy(e,(function(e){var i=C.a.filter(a,(function(a){return a<e[t]})).length;return n[i]}))}(this.data,e,t);return C.a.mapObject(a,(function(e,t){return new P(e)}))}},{key:"getAttr",value:function(e){return this.data.map((function(t){return t[e]}))}},{key:"setAttr",value:function(e,t){for(var a=0;a<this.n;a++){var n=this.data[a];n[e]=t[a],this.data[a]=n}this.metas.push({name:e,nUnique:Object(f.a)(new Set(t)).length,type:K(t[0])})}},{key:"getColorOptions",value:function(){var e=this,t=this.metas.filter((function(t){return t.nUnique<e.n&&t.nUnique>1}));return t=t.map((function(e){return{value:e.name,label:e.name}}))}},{key:"getShapeOptions",value:function(){var e=this.metas.filter((function(e){return"float"!==e.type&&e.nUnique<7&&e.nUnique>1}));return e=e.map((function(e){return{value:e.name,label:e.name}}))}},{key:"getSearchOptions",value:function(e){var t,a=this,n=[],i=Object(u.a)(e);try{var s=function(){var e=t.value,i=a.getAttr(e);i=(i=Object(f.a)(new Set(i))).map((function(t){return{value:t,label:t,key:e}})),i={label:e,options:i},n.push(i)};for(i.s();!(t=i.n()).done;)s()}catch(r){i.e(r)}finally{i.f()}return n}},{key:"calculateColorScale",value:function(e){var t=this.getAttr(e),a=C.a.findWhere(this.metas,{name:e}),n=a.type;"float"!==n&&"int"!==n&&a.nUnique>20&&(t=M(t,19));var i=new Set(t),s=i.size;if(-1!==(i=Array.from(i)).indexOf("unknown")&&i.length>7){var r=i.indexOf("unknown"),o=7;20===i.length&&(o=15);var l=i[o];i[o]="unknown",i[r]=l}if(-1!==i.indexOf(I)&&20===i.length){var c=i.indexOf(I),h=15;-1!==i.indexOf("unknown")&&(h=14);var u=i[h];i[h]=I,i[c]=u}var d=x.a(t),p=d[0],f=d[1],y=E.a().domain([p,(p+f)/2,f]).range(["#1f77b4","#ddd","#d62728"]);if("boolean"===n)y=R.a().domain([!0,!1]).range(["#cc0000","#cccccc"]);else if(s<11)y=R.a(x.c).domain(i);else if(s>10&&s<=20)y=R.a(x.c).domain(i);else if(s<=40){y=R.a().range(["#1b70fc","#faff16","#d50527","#158940","#f898fd","#24c9d7","#cb9b64","#866888","#22e67a","#e509ae","#9dabfa","#437e8a","#b21bff","#ff7b91","#94aa05","#ac5906","#82a68d","#fe6616","#7a7352","#f9bc0f","#b65d66","#07a2e6","#c091ae","#8a91a7","#88fc07","#ea42fe","#9e8010","#10b437","#c281fe","#f92b75","#07c99d","#a946aa","#bfd544","#16977e","#ff6ac8","#a88178","#5776a9","#678007","#fa9316","#85c070","#6aa2a9","#989e5d","#fe9169","#cd714a","#6ed014","#c5639c","#c23271","#698ffc","#678275","#c5a121","#a978ba","#ee534e","#d24506","#59c3fa","#ca7b0a","#6f7385","#9a634a","#48aa6f","#ad9ad0","#d7908c","#6a8a53","#8c46fc","#8f5ab8","#fd1105","#7ea7cf","#d77cd1","#a9804b","#0688b4","#6a9f3e","#ee8fba","#a67389","#9e8cfe","#bd443c","#6d63ff","#d110d5","#798cc3","#df5f83","#b1b853","#bb59d8","#1d960c","#867ba8","#18acc9","#25b3a7","#f3db1d","#938c6d","#936a24","#a964fb","#92e460","#a05787","#9c87a0","#20c773","#8b696d","#78762d","#e154c6","#40835f","#d73656","#1afd5c","#c4f546","#3d88d8","#bd3896","#1397a3","#f940a5","#66aeff","#d097e7","#fe6ef9","#d86507","#8b900a","#d47270","#e8ac48","#cf7c97","#cebb11","#718a90","#e78139","#ff7463","#bea1fd"]).domain(i)}return y}},{key:"calculateShapeScale",value:function(e){var t,a=x.f.map((function(e){return x.e().type(e)()})),n=C.a.findWhere(this.metas,{name:e}),i=this.groupBy(e),s=R.a().domain(Object.keys(i)).range(a);if(-1!==["int","float"].indexOf(n.type)&&n.nUnique>6){i=this.binBy(e,6);var r=B(C.a.pluck(this.data,e),6);if("p-value"===n.name){var o=[.001,.01,.05,.1,1];i=this.binBy2(e,o),r=D(C.a.pluck(this.data,e),o),a=C.a.map(x.f.slice(0,o.length),(function(e){return x.e().type(e)()}))}s=T.a().domain(r.domain).range(a),t=r.labels}return{shapeScale:s,shapeLabels:t,scatterDataSubsets:i}}}]),e}(),F=function(){function e(t){Object(m.a)(this,e),this.model=t.model,this.geometry=null,this.createGeometry()}return Object(A.a)(e,[{key:"createGeometry",value:function(){var e=new g.b,t=this.model;e.setIndex(new g.a(t.indices,1)),e.setAttribute("position",new g.a(t.positions,3)),e.userData={index:t.getAttr("index")},e.computeBoundingSphere(),this.geometry=e}}]),e}(),L=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;Object(m.a)(this,a);var i=(n=t.call(this,e)).props.is3d;return n.state={isLoading:!1,isLoaded:!1,url:n.props.url,data:n.props.data,model:null,WIDTH:n.props.width||1400,HEIGHT:n.props.height||800,DPR:n.props.DPR||2,labelKeys:n.props.labelKeys,colorKey:n.props.colorKey,shapeKey:n.props.shapeKey,pointSize:i?.5:12,is3d:i,colorScale:n.props.colorScale,shapeScale:n.props.shapeScale,shapeLabels:n.props.shapeLabels},n.onMouseMove=n.onMouseMove.bind(Object(y.a)(n)),n.onMouseDown=n.onMouseDown.bind(Object(y.a)(n)),n.onMouseUp=n.onMouseUp.bind(Object(y.a)(n)),n.onClick=n.onClick.bind(Object(y.a)(n)),n}return Object(A.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.url&&(this.setState({isLoading:!0}),fetch(this.props.url).then((function(e){if(e.ok)return e.json();throw new Error("Something went wrong when fetching data ...")})).then((function(t){e.setState({data:t,model:new z(t),isLoading:!1,isLoaded:!0}),e.makeMaterial(),e.setUpStage(),e.shapeBy(e.state.shapeKey)})))}},{key:"componentDidUpdate",value:function(e,t,a){this.props.url||(null===t.data&&null===e.data&&null!==this.props.data&&null===this.state.data?(this.makeMaterial(),this.setUpStage()):null!==this.props.data&&null!==this.props.shapeScale?(this.shapeBy(this.props.shapeKey),this.startAnimate()):(this.props.colorKey,e.colorKey))}},{key:"componentWillUnmount",value:function(){this.animateId&&this.stopAnimate()}},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{ref:function(t){return e.mount=t},onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onClick:this.onClick})}},{key:"setUpStage",value:function(){var e=this.state,t=e.WIDTH,a=e.HEIGHT,n=e.DPR,i=t/a,s=new g.m;this.id=s.uuid;var r=new g.w;r.setClearColor(16777215),r.setPixelRatio(n),r.setSize(t,a);var o=10.5,l=-10.5,c=o,h=-10.5,u=o;i>1?(l*=i,c*=i):(u/=i,h/=i);var d=new g.h(l,c,u,h,-1e3,1e3);this.state.is3d&&((d=new g.i(70,i,.01,1e6)).position.z=30),r.domElement.id="renderer-"+this.id,this.mount.appendChild(r.domElement);var p=new j.a(d,r.domElement);p.enableZoom=!0,p.enableDamping=!0,p.dampingFactor=.25,p.screenSpacePanning=!0,this.state.is3d?(p.autoRotate=!0,p.autoRotateSpeed=2):(p.enableRotate=!1,p.mouseButtons={LEFT:g.g.RIGHT,MIDDLE:g.g.DOLLY,RIGHT:g.g.LEFT}),p.addEventListener("start",(function(){p.autoRotate=!1}));var f=new g.t;this.scene=s,this.renderer=r,this.camera=d,this.controls=p,this.mouse=f,this.updated=!0}},{key:"onMouseDown",value:function(e){this.mouseMoved=!1}},{key:"onMouseMove",value:function(e){var t=this.state,a=t.WIDTH,n=t.HEIGHT;void 0!==e.nativeEvent&&Object.assign(this.mouse,{x:e.nativeEvent.offsetX/a*2-1,y:-e.nativeEvent.offsetY/n*2+1}),this.updated=!0,this.mouseMoved=!0}},{key:"onMouseUp",value:function(e){!0!==this.mouseMoved&&this.onClick(e)}},{key:"onClick",value:function(e){if("function"===typeof this.props.onClick){var t=this.points.geometry.userData.index[this.getPoint()],a=this.props.model.data[t];this.props.onClick(e,a)}}},{key:"makeMaterial",value:function(){var e,t=[],a=Object(u.a)(k);try{for(a.s();!(e=a.n()).done;){var n=e.value,i=new S(n).load(),s=new g.k({vertexColors:g.v,size:this.state.pointSize,sizeAttenuation:this.state.is3d,map:i,alphaTest:.2,transparent:!0,opacity:.6});t.push(s)}}catch(r){a.e(r)}finally{a.f()}this.materials=t}},{key:"clearScene",value:function(){var e,t=this.scene,a=Object(u.a)(t.children);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.remove(n)}}catch(i){a.e(i)}finally{a.f()}}},{key:"shapeBy",value:function(e){for(var t=this.props.model,a=this.scene,n=t.calculateShapeScale(e).scatterDataSubsets,i=[],s=0,r=Object.keys(n);s<r.length;s++){var o=r[s],l=new F({model:n[o]});i.push(l.geometry)}var c=O.a.mergeBufferGeometries(i),h=i.map((function(e){return e.userData.index})).reduce((function(e,t){return e.concat(t)})),u=t.getLabels(this.state.labelKeys);u=U(u,h),c.userData={index:h,labels:u};var d=i.map((function(e){return e.index.count})),p=d.reduce((function(e,t,a){return[].concat(Object(f.a)(e),[t+(e[a-1]||0)])}),[]);p.unshift(-1);for(var y=0;y<i.length;y++)c.addGroup(p[y]+1,d[y],y);var v=new g.j(c,this.materials);this.clearScene(),a.add(v),this.points=v,this.setColors(this.props.colorScale,this.props.colorKey)}},{key:"renderScatter",value:function(){var e=this.getPoint();this.resetColors();var t=document.getElementById("text-label-"+this.id);if(t&&t.remove(),void 0!==e){this.points.geometry.attributes.color.needsUpdate=!0,this.points.geometry.attributes.color.array[3*e]=.1,this.points.geometry.attributes.color.array[3*e+1]=.8,this.points.geometry.attributes.color.array[3*e+2]=.1;var a={x:this.points.geometry.attributes.position.array[3*e],y:this.points.geometry.attributes.position.array[3*e+1],z:this.points.geometry.attributes.position.array[3*e+2]},n=this.makeTextCanvas(this.points.geometry.userData.labels[e],a.x,a.y,a.z,this.points.rotation,{fontsize:24,fontface:"arial, sans-serif",textColor:{r:0,g:0,b:0,a:.8}});if(n.id="text-label-"+this.id,this.mount.appendChild(n),"function"===typeof this.props.onMouseOver){var i=this.points.geometry.userData.index[e],s=this.props.model.data[i];this.props.onMouseOver(s)}}}},{key:"makeTextCanvas",value:function(e,t,a,n,i,s){void 0===s&&(s={});var r,o=s.hasOwnProperty("fontface")?s.fontface:"arial, sans-serif",l=s.hasOwnProperty("fontsize")?s.fontsize:18,c=s.hasOwnProperty("textColor")?s.textColor:{r:0,g:0,b:255,a:.8},h=s.hasOwnProperty("lineHeight")?s.lineHeight:20,u=document.createElement("canvas"),d=u.getContext("2d"),p=this.state,f=p.WIDTH,y=p.HEIGHT;u.width=f,u.height=y,d.font=l+"px "+o,d.textBaseline="alphabetic",d.textAlign="left",d.fillStyle="rgba("+(r=c).r+","+r.g+","+r.b+","+r.a+")";for(var v=new g.u(t,a,n).applyEuler(i),b=(new g.u).copy(v).project(this.camera),m={x:(b.x+1)/2*f,y:-(b.y-1)/2*y},A=e.split("\n"),j=0;j<A.length;j++)d.fillText(A[j],m.x,m.y+j*h);return u.style.left=0,u.style.top=0,u.style.position="absolute",u.style.pointerEvents="none",u}},{key:"resetColors",value:function(){this.setColors(this.props.colorScale,this.props.colorKey)}},{key:"setColors",value:function(e,t){var a=this.props.model,n=a.getAttr(t),i=this.points.geometry;n=U(n,i.userData.index);var s=C.a.findWhere(a.metas,{name:t}),r=s.type;"float"!==r&&"int"!==r&&s.nUnique>20&&(n=M(n,19));var o=new Float32Array(3*a.n),l={length:2};e.hasOwnProperty("domain")&&(l=e.domain().slice());for(var c=n.length-1;c>=0;c--){var h=e(n[c]);(h=new g.c(h)).toArray(o,3*c)}if(l.length>3)for(var u=n.length-1;u>=0;u--){var d=e(n[u]);-1===l.indexOf(n[u])&&(d=e(I)),(d=new g.c(d)).toArray(o,3*u)}i.setAttribute("color",new g.a(o.slice(),3))}},{key:"startAnimate",value:function(){this.animateId||this.animate()}},{key:"animate",value:function(){var e=this,t=this.renderer,a=this.scene,n=this.camera;this.controls.update(),this.updated&&(this.renderScatter(),this.updated=!1),t.render(a,n),this.animateId=window.requestAnimationFrame((function(){return e.animate()}))}},{key:"stopAnimate",value:function(){window.cancelAnimationFrame(this.animateId)}},{key:"highlightQuery",value:function(e,t){this.removeHighlightedPoints();var a=U(this.props.model.data,this.points.geometry.userData.index).filter((function(a){return a[e]===t})),n=new P(a),i=this.createHighlightCloud(n);i.name="highlight-"+this.id,this.scene.add(i)}},{key:"createHighlightCloud",value:function(e){var t=new F({model:e}),a=new g.k({size:5*this.state.pointSize,sizeAttenuation:this.state.is3d,map:this.materials[0].map,transparent:!0,opacity:.4,color:16776960}),n=new g.j(t.geometry,a);return n.rotation.x=this.points.rotation.x,n.rotation.y=this.points.rotation.y,n}},{key:"removeHighlightedPoints",value:function(){var e=this.scene;e.remove(e.getObjectByName("highlight-"+this.id))}},{key:"getPoint",value:function(){var e,t=this.mouse,a=this.camera,n=void 0,i=void 0,s=new g.u,r=new g.t,o=Object(u.a)(this.points.geometry.index.array);try{for(o.s();!(e=o.n()).done;){var l=e.value;s.set(this.points.geometry.attributes.position.array[3*l],this.points.geometry.attributes.position.array[3*l+1],this.points.geometry.attributes.position.array[3*l+2]),s.project(a),r.set(s.x,s.y);var c=r.distanceToSquared(t);c<Math.min(1,1/(a.zoom*a.zoom))&&(void 0===i||c<i)&&(n=l,i=c)}}catch(h){o.e(h)}finally{o.f()}return n}}]),a}(s.a.Component),V=a(46),H=a(47),G=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={width:n.props.width||300,height:n.props.height||800},n}return Object(A.a)(a,[{key:"componentDidMount",value:function(){this.setUpDOMs()}},{key:"componentDidUpdate",value:function(e,t,a){e.colorScale!==this.props.colorScale&&this.displayColorLegend(this.props.colorScale,this.props.colorKey),e.shapeScale!==this.props.shapeScale&&this.displayShapeLegend(this.props.shapeScale,this.props.shapeKey,this.props.shapeLabels)}},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{ref:function(t){return e.mount=t}})}},{key:"setUpDOMs",value:function(){var e=this.state,t=e.width,a=e.height;this.el=x.d(this.mount).append("svg").attr("id","legend").attr("width",t).attr("height",a),this.g=this.el.append("g").attr("class","legend").attr("transform","translate(10, 20)"),this.g.append("g").attr("id","legendShape").attr("class","legendPanel").attr("transform","translate(0, 0)"),this.g.append("g").attr("id","legendColor").attr("class","legendPanel").attr("transform","translate(110, 0)"),this.mount.style.position="absolute",this.mount.style.zIndex=10,this.mount.style.overflow="visible",this.mount.style.left=0,this.mount.style.top=0,this.mount.style.pointerEvents="none"}},{key:"displayShapeLegend",value:function(e,t,a){var n=V.a.legendSymbol().scale(e).orient("vertical").title(t);a&&n.labels(a),this.g.select("#legendShape").call(n)}},{key:"displayColorLegend",value:function(e,t){var a=V.a.legendColor().title(t).shapeWidth(20).cells(5).labelFormat(x.b(".2f")).scale(e);this.g.select("#legendColor").call(a)}}]),a}(s.a.Component),Q=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={label:n.props.label,options:null,defaultValue:n.props.defaultValue},n.handleChange=n.handleChange.bind(Object(y.a)(n)),n}return Object(A.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{ref:function(t){return e.mount=t},children:[Object(n.jsx)("label",{children:this.props.label}),Object(n.jsx)(H.a,{defaultValue:this.state.defaultValue,options:this.props.options,onChange:this.handleChange,styles:{container:function(){return{width:e.props.width}}}})]})}},{key:"handleChange",value:function(e){this.props.onSelectChange(e)}}]),a}(s.a.Component),q=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={searchStr:"",searched:!1},n.handleChange=n.handleChange.bind(Object(y.a)(n)),n.handleClear=n.handleClear.bind(Object(y.a)(n)),n}return Object(A.a)(a,[{key:"render",value:function(){var e=this,t=this.state.searched;return Object(n.jsxs)("div",{ref:function(t){return e.mount=t},children:[Object(n.jsx)("label",{children:this.props.label}),Object(n.jsx)(H.a,{defaultValue:"",defaultInputValue:"",placeholder:"Type to search...",options:this.props.options,onChange:this.handleChange,styles:{container:function(){return{width:e.props.width}}}}),t&&Object(n.jsx)("button",{onClick:this.handleClear,className:"btn btn-sm btn-outline-secondary",style:{marginTop:5},children:"Clear highlighted points"})]})}},{key:"handleChange",value:function(e){this.setState({searched:!0}),this.props.onInputChange(e)}},{key:"handleClear",value:function(){this.setState({searched:!1}),this.props.onClearBtnClicked()}}]),a}(s.a.Component),W=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={data:null,model:null,colorScale:null,shapeScale:null,shapeLabels:null,colorKey:n.props.colorKey,shapeKey:n.props.shapeKey,labelKeys:n.props.labelKeys,searchKeys:n.props.searchKeys,is3d:n.props.is3d},n.handleColorKeyChange=n.handleColorKeyChange.bind(Object(y.a)(n)),n.handleShapeKeyChange=n.handleShapeKeyChange.bind(Object(y.a)(n)),n.handleSearchInputChange=n.handleSearchInputChange.bind(Object(y.a)(n)),n.handleClearBtnClick=n.handleClearBtnClick.bind(Object(y.a)(n)),n}return Object(A.a)(a,[{key:"componentDidMount",value:function(){void 0!==this.props.data&&this.setState({data:this.props.data,model:new z(this.props.data)})}},{key:"componentDidUpdate",value:function(e,t){if(e.data!==this.props.data&&(void 0===this.props.data?this.setState({data:null,model:null}):this.setState({data:this.props.data,model:new z(this.props.data)})),null===t.data&&t.data!==this.state.data){var a=this.state,n=a.colorKey,i=a.shapeKey,s=this.state.model,r=s.calculateColorScale(n),o=s.calculateShapeScale(i),l=o.shapeScale,c=o.shapeLabels;this.setState({colorScale:r,shapeScale:l,shapeLabels:c})}}},{key:"render",value:function(){var e=this,t=this.state,a=t.colorKey,i=t.shapeKey,s=t.labelKeys,r=t.searchKeys,o=t.is3d,l=this.state,c=l.colorScale,h=l.shapeScale,u=l.shapeLabels,d=this.props,p=d.width,f=d.height,y=null,v=null,b=null;return this.state.model&&(y=this.state.model.getColorOptions(),v=this.state.model.getShapeOptions(),r&&(b=this.state.model.getSearchOptions(r))),Object(n.jsxs)("div",{style:{position:"relative",padding:0,width:p,height:f},children:[Object(n.jsx)(L,{data:this.state.data,model:this.state.model,width:p,height:f,DPR:window.devicePixelRatio,colorKey:a,shapeKey:i,labelKeys:s,colorScale:c,shapeScale:h,shapeLabels:h,is3d:o,onClick:this.props.onClick,onMouseOver:this.props.onMouseOver,ref:function(t){e.scatter3dView=t}}),Object(n.jsx)(G,{colorScale:c,colorKey:a,shapeScale:h,shapeKey:i,shapeLabels:u}),Object(n.jsxs)("div",{style:{zIndex:10,top:0,right:0,width:200,position:"absolute"},children:[y&&y.length>1&&Object(n.jsx)(Q,{label:"Color by:",defaultValue:{value:a,label:a},options:y,onSelectChange:this.handleColorKeyChange,width:180}),v&&v.length>1&&Object(n.jsx)(Q,{label:"Shape by:",defaultValue:{value:i,label:i},options:v,onSelectChange:this.handleShapeKeyChange,width:180}),r&&r.length>1&&Object(n.jsx)(q,{label:"Search:",options:b,onInputChange:this.handleSearchInputChange,onClearBtnClicked:this.handleClearBtnClick,width:180})]})]})}},{key:"handleColorKeyChange",value:function(e){var t=e.value;if(t!==this.state.colorKey){var a=this.state.model.calculateColorScale(t);this.setState({colorKey:t,colorScale:a})}}},{key:"handleShapeKeyChange",value:function(e){var t=e.value;if(t!==this.state.shapeKey){var a=this.state.model.calculateShapeScale(t),n=a.shapeScale,i=a.shapeLabels;this.setState({shapeKey:t,shapeScale:n,shapeLabels:i})}}},{key:"handleSearchInputChange",value:function(e){var t=e.key,a=e.value;this.scatter3dView.highlightQuery(t,a)}},{key:"handleClearBtnClick",value:function(){this.scatter3dView.removeHighlightedPoints()}}]),a}(s.a.Component);s.a.Component;function Y(e){return(0|e)==e?"int":1*e==e?"float":"up"===e||"down"===e?"direction":"string"}function J(e){return X.apply(this,arguments)}function X(){return(X=Object(d.a)(h.a.mark((function e(t){var a,n,i,s,r,o,l,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return a=e.sent,e.next=5,a.text();case 5:if(n=e.sent,i=n.split("\n").filter((function(e){return""!==e.replace(/^\s+|\s+$/g,"")})).map((function(e){return e.split("\t")})),s=i.shift(),0!==i.length){e.next=10;break}return e.abrupt("return",{header:s,data:[],dtype:{}});case 10:for(r=i[0],o={},l=0;l<r.length;l++)o[s[l]]=Y(r[l]);return c=i.map((function(e){for(var t={},a=0;a<e.length;a++)"int"===o[s[a]]?t[s[a]]=0|e[a]:"float"===o[s[a]]?t[s[a]]=1*e[a]:t[s[a]]=e[a];return t})),e.abrupt("return",{header:s,data:c,dtype:o});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(237);var N=a(45);a(23),a(243),a(244);function Z(e){return"up"===e.value?'<b style="font-size:200%;">&uarr;</b style="font-size:200%;">':'<b style="font-size:200%;">&darr;</b style="font-size:200%;">'}var _=function(){var e=Object(i.useState)(void 0),t=Object(p.a)(e,2),a=t[0],s=t[1],r=Object(i.useState)(void 0),o=Object(p.a)(r,2),c=o[0],f=o[1],y=Object(i.useState)(void 0),v=Object(p.a)(y,2),b=v[0],m=v[1],A=Object(i.useState)(void 0),g=Object(p.a)(A,2),j=(g[0],g[1]);return Object(i.useEffect)((function(){Object(d.a)(h.a.mark((function e(){var t,a,n,i,r,o,l,c,d,f,y,v;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J("LM2_Deidentified_UMAP.tsv");case 2:t=e.sent,a=t.data,n=[],i=Object(u.a)(a);try{for(i.s();!(r=i.n()).done;)o=r.value,l=o.sid.split("-"),c=Object(p.a)(l,4),d=c[0],f=c[1],y=c[2],v=c[3],n.push({x:1*o["UMAP-1"],y:1*o["UMAP-2"],sid:o.sid,pid:d.slice(1),type:f,cluster:y.slice(1),visit:v.slice(1)})}catch(h){i.e(h)}finally{i.f()}s(n);case 8:case"end":return e.stop()}}),e)})))(),Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,J("LM2_Cluster_Enrich.tsv");case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),[]),Object(n.jsxs)("div",{className:"App",children:[Object(n.jsxs)("div",{className:"header",children:[Object(n.jsx)("h1",{className:"title",children:"Lyme MIND 2"}),Object(n.jsxs)("p",{className:"description",children:["This interactive viewer allows you to explore the ",Object(n.jsx)("a",{href:"https://www.lymemind.org/",children:"Lyme MIND 2"})," Patient Cohort in gene expression space. Each point corresponds to a participant in our study, there position was computed based on a UMAP projection of their RNAseq expression. Per-cluster enrichment analysis can be explored by clicking on a cluster to filter and review the table below. This was computed by performing differential expression between clusters and using the most significantly up and down regulated genes to query with ",Object(n.jsx)("a",{href:"http://maayanlab.cloud/Enrichr/",children:"Enrichr"}),". The ",Object(n.jsx)("a",{href:"https://maayanlab.github.io/react-scatter-board/",children:"react scatter board widget"})," is being used to render this plot, its widgets can also be used to change which aspect of the metadata is used to color or shape each point."]})]}),Object(n.jsx)("div",{className:"canvas",children:void 0===a?Object(n.jsx)("div",{children:"Loading..."}):Object(n.jsx)(W,{data:a,shapeKey:"type",colorKey:"cluster",labelKeys:["pid","type","cluster","visit"],searchKeys:["sid","pid","type","cluster","visit"],is3d:!1,width:800,height:350,onClick:function(e,t){b.setFilterModel(Object(l.a)(Object(l.a)({},b.getFilterModel()||{}),{},{cluster:{filterType:"text",type:"equals",filter:t.cluster}}))}})}),Object(n.jsx)("div",{className:"table ag-theme-material",children:void 0===c?Object(n.jsx)("div",{children:"Loading..."}):Object(n.jsx)(N.AgGridReact,{onGridReady:function(e){m(e.api),j(e.columnApi),e.columnApi.autoSizeAllColumns(),e.api.setFilterModel({adjusted_pvalue:{filterType:"number",type:"lessThan",filter:.05}}),e.columnApi.applyColumnState({state:[{colId:"rank",sort:"asc"},{colId:"adjusted_pvalue",sort:"asc"}],defaultState:{sort:null}})},rowData:c.data,children:["rank","direction","library","term","adjusted_pvalue","category","cluster"].map((function(e,t){return Object(n.jsx)(N.AgGridColumn,{colId:e,field:e,sortable:!0,cellStyle:{string:{textAlign:"left"}}[c.dtype[e]],filter:{int:"agNumberColumnFilter",float:"agNumberColumnFilter",string:"agTextColumnFilter"}[c.dtype[e]],type:{int:"numericColumn",float:"numericColumn",string:"stringColumn"}[c.dtype[e]],resizable:!0,valueFormatter:{int:void 0,float:function(e){return e.value.toPrecision(3)}}[c.dtype[e]],cellRenderer:{direction:Z}[c.dtype[e]],comparator:function(t,a){return"int"===c.dtype[e]||"float"===c.dtype[e]?t-a:t>a?1:t<a?-1:0}},e)}))})})]})},$=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,254)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),i(e),s(e),r(e)}))};o.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(_,{})}),document.getElementById("root")),$()}},[[245,1,2]]]);
//# sourceMappingURL=main.38cc9cc4.chunk.js.map